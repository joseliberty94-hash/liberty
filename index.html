// -------------------------
// Función para guardar datos
// -------------------------
function doPost(e) {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var data = JSON.parse(e.postData.contents);

  if (data.tipo === "accion") {
    var sheet = ss.getSheetByName("Acciones comerciales");
    sheet.appendRow([
      data.fecha,
      data.agencia,
      data.vendedor,
      data.tipoAccion,
      data.observacion
    ]);
  } 
  else if (data.tipo === "agencia") {
    var sheet = ss.getSheetByName("Agencias");
    sheet.appendRow([
      data.nombre,
      data.mail,
      data.telefono
    ]);
  } 
  else if (data.tipo === "vendedor") {
    var sheet = ss.getSheetByName("Vendedores");
    sheet.appendRow([
      data.nombre,
      data.mail,
      data.estado
    ]);
  } 
  else {
    return ContentService
            .createTextOutput(JSON.stringify({status:"error", msg:"Tipo desconocido"}))
            .setMimeType(ContentService.MimeType.JSON);
  }

  return ContentService
           .createTextOutput(JSON.stringify({status: "ok"}))
           .setMimeType(ContentService.MimeType.JSON);
}


// -------------------------
// Función para leer datos
// -------------------------
function doGet(e) {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var hoja = e.parameter.hoja;

  if (!hoja) {
    return ContentService
             .createTextOutput(JSON.stringify({status:"error", msg:"Parámetro hoja requerido"}))
             .setMimeType(ContentService.MimeType.JSON);
  }

  var sheet = ss.getSheetByName(hoja);
  if (!sheet) {
    return ContentService
             .createTextOutput(JSON.stringify({status:"error", msg:"Hoja no encontrada"}))
             .setMimeType(ContentService.MimeType.JSON);
  }

  var data = sheet.getDataRange().getValues(); // todas las filas
  data.shift(); // eliminar encabezado

  return ContentService
           .createTextOutput(JSON.stringify(data))
           .setMimeType(ContentService.MimeType.JSON);
}
