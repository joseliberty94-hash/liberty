<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>CRM Liberty</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<style>
body {margin:0; font-family:'Poppins',sans-serif; display:flex; background:#f4f6f9;}
.sidebar {width:230px; background:#0f172a; color:white; height:100vh; padding:20px;}
.sidebar h2 {text-align:center; margin-bottom:30px;}
.sidebar a {display:block; padding:12px; color:white; text-decoration:none; border-radius:8px; margin-bottom:10px; cursor:pointer;}
.sidebar a:hover {background:#1e293b;}
.main {flex:1; padding:25px; overflow-y:auto;}
.card {background:white; padding:20px; border-radius:14px; box-shadow:0 0 10px rgba(0,0,0,.1); margin-bottom:20px;}
h2 {margin-top:0;}
input, select, textarea, button {padding:10px; border-radius:8px; border:1px solid #ccc; margin:5px 0;}
button {background:#2563eb; color:white; border:none; cursor:pointer;}
button:hover {background:#1d4ed8;}
table {width:100%; border-collapse:collapse; margin-top:15px;}
th, td {padding:10px; border-bottom:1px solid #ddd; text-align:center;}
th {background:#e5e7eb;}
.botones-registro {display:flex; gap:10px; margin-bottom:15px;}
.botones-registro button {flex:1; font-size:14px; padding:8px;}
.modal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:100;}
.modal-content {background:white; padding:25px; border-radius:12px; width:400px; max-width:90%; position:relative;}
.modal-close {position:absolute; top:10px; right:15px; cursor:pointer; font-weight:bold; font-size:18px;}
</style>
</head>
<body>

<div class="sidebar">
  <h2>CRM Liberty</h2>
  <a onclick="mostrarSeccion('crmComercial')"> CRM Comercial</a>
  <a onclick="mostrarSeccion('libertyStats')"> Liberty Statistics</a>
</div>

<div class="main">
  <!-- CRM Comercial -->
  <div id="crmComercial" class="seccion">
    <div class="card">
      <h2>CRM Comercial</h2>
      <div class="botones-registro">
        <button onclick="abrirModal('modalAgencias')">Agencia</button>
        <button onclick="abrirModal('modalVendedores')">Vendedor</button>
        <button onclick="abrirModal('modalAcciones')">Acci贸n</button>
      </div>
    </div>

    <div class="card">
      <h2>Listado de Acciones Comerciales</h2>
      <table>
        <thead>
          <tr>
            <th>Fecha</th><th>Agencia</th><th>Vendedor</th><th>Tipo</th><th>Observaci贸n</th>
          </tr>
        </thead>
        <tbody id="tablaAcciones"></tbody>
      </table>
    </div>
  </div>

  <div id="libertyStats" class="seccion" style="display:none;">
    <div class="card">
      <h2>Liberty Statistics</h2>
      <p>Pr贸ximamente: panel de estad铆sticas y KPIs</p>
    </div>
  </div>
</div>

<!-- Modales -->
<div id="modalAgencias" class="modal">
  <div class="modal-content">
    <span class="modal-close" onclick="cerrarModal('modalAgencias')">&times;</span>
    <h2>Registrar Agencia</h2>
    <input type="text" id="agNombre" placeholder="Nombre">
    <input type="email" id="agMail" placeholder="Mail">
    <input type="text" id="agTelefono" placeholder="Tel茅fono">
    <button onclick="guardarAgencia()">Guardar Agencia</button>
  </div>
</div>

<div id="modalVendedores" class="modal">
  <div class="modal-content">
    <span class="modal-close" onclick="cerrarModal('modalVendedores')">&times;</span>
    <h2>Registrar Vendedor</h2>
    <input type="text" id="veNombre" placeholder="Nombre">
    <input type="email" id="veMail" placeholder="Mail">
    <select id="veEstado">
      <option value="Activo">Activo</option>
      <option value="Inactivo">Inactivo</option>
    </select>
    <button onclick="guardarVendedor()">Guardar Vendedor</button>
  </div>
</div>

<div id="modalAcciones" class="modal">
  <div class="modal-content">
    <span class="modal-close" onclick="cerrarModal('modalAcciones')">&times;</span>
    <h2>Registrar Acci贸n Comercial</h2>
    <input type="date" id="acFecha">
    <select id="acAgencia"><option value="">Seleccione Agencia</option></select>
    <select id="acVendedor"><option value="">Seleccione Vendedor</option></select>
    <input type="text" id="acTipo" placeholder="Tipo de Acci贸n">
    <textarea id="acObs" placeholder="Observaci贸n"></textarea>
    <button onclick="guardarAccion()">Guardar Acci贸n</button>
  </div>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzhpio0y8ZwHZppVJ6-lWB8FjrzJUhvBlFGFwncfVC6COIROBl3dQyLxG7QFP9zKDDjVQ/exec";

// Secciones
function mostrarSeccion(id){
  document.querySelectorAll('.seccion').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
}

// Modales
function abrirModal(id){document.getElementById(id).style.display='flex';}
function cerrarModal(id){document.getElementById(id).style.display='none';}

let acciones = [];

// Cargar acciones existentes
function cargarAcciones(){
  fetch(WEB_APP_URL + "?hoja=Acciones comerciales")
    .then(r=>r.json())
    .then(data=>{
      acciones = [];
      data.forEach(row=>{
        acciones.push({
          fecha: row[0],
          agencia: row[1],
          vendedor: row[2],
          tipoAccion: row[3],
          observacion: row[4]
        });
      });
      mostrarAcciones();
    }).catch(e=>console.error("Error cargando acciones:", e));
}

// Mostrar tabla
function mostrarAcciones(){
  const tbody = document.getElementById('tablaAcciones');
  tbody.innerHTML = '';
  acciones.forEach(a=>{
    tbody.innerHTML += `<tr>
      <td>${a.fecha}</td>
      <td>${a.agencia}</td>
      <td>${a.vendedor}</td>
      <td>${a.tipoAccion}</td>
      <td>${a.observacion}</td>
    </tr>`;
  });
}

// Registrar Agencia
function guardarAgencia(){
  const nombre=document.getElementById('agNombre').value;
  const mail=document.getElementById('agMail').value;
  const telefono=document.getElementById('agTelefono').value;
  if(!nombre||!mail) return alert("Complete todos los campos");
  fetch(WEB_APP_URL,{method:"POST", body:JSON.stringify({tipo:"agencia", nombre, mail, telefono})})
    .then(r=>r.json()).then(()=>{alert("Agencia guardada"); cerrarModal('modalAgencias'); cargarAgencias();})
    .catch(e=>alert(e));
}

// Registrar Vendedor
function guardarVendedor(){
  const nombre=document.getElementById('veNombre').value;
  const mail=document.getElementById('veMail').value;
  const estado=document.getElementById('veEstado').value;
  if(!nombre||!mail) return alert("Complete todos los campos");
  fetch(WEB_APP_URL,{method:"POST", body:JSON.stringify({tipo:"vendedor", nombre, mail, estado})})
    .then(r=>r.json()).then(()=>{alert("Vendedor guardado"); cerrarModal('modalVendedores'); cargarVendedores();})
    .catch(e=>alert(e));
}

// Registrar Acci贸n
function guardarAccion(){
  const fecha=document.getElementById('acFecha').value;
  const agencia=document.getElementById('acAgencia').value;
  const vendedor=document.getElementById('acVendedor').value;
  const tipo=document.getElementById('acTipo').value;
  const obs=document.getElementById('acObs').value;
  if(!fecha||!agencia||!vendedor||!tipo) return alert("Complete todos los campos");
  const accion={tipo:"accion", fecha, agencia, vendedor, tipoAccion:tipo, observacion:obs};
  fetch(WEB_APP_URL,{method:"POST", body:JSON.stringify(accion)})
    .then(r=>r.json())
    .then(()=>{alert("Acci贸n guardada"); cerrarModal('modalAcciones'); cargarAcciones();})
    .catch(e=>alert(e));
}

// Cargar Agencias y Vendedores para dropdowns
function cargarAgencias(){
  fetch(WEB_APP_URL+"?hoja=Agencias").then(r=>r.json()).then(data=>{
    const sel=document.getElementById('acAgencia'); sel.innerHTML='<option value="">Seleccione Agencia</option>';
    data.forEach(a=>{let o=document.createElement('option'); o.value=a[0]; o.text=a[0]; sel.add(o);});
  });
}
function cargarVendedores(){
  fetch(WEB_APP_URL+"?hoja=Vendedores").then(r=>r.json()).then(data=>{
    const sel=document.getElementById('acVendedor'); sel.innerHTML='<option value="">Seleccione Vendedor</option>';
    data.forEach(v=>{let o=document.createElement('option'); o.value=v[0]; o.text=v[0]; sel.add(o);});
  });
}

// Inicializar
cargarAgencias();
cargarVendedores();
cargarAcciones();

</script>
</body>
</html>
